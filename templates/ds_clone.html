<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>数据源克隆</title>
    <link href="{{static_url('plugins/bootstrap-sweetalert/sweet-alert.css')}}" rel="stylesheet" type="text/css">
    <link href="{{static_url('plugins/toastr/toastr.min.css')}}" rel="stylesheet" type="text/css" />
    <link href="{{static_url('assets/css/components.css')}}" rel="stylesheet" type="text/css" />
</head>
<body>
   <p></p>
   <form class="form-horizontal" role="form">
       <div class="row">
          <div class="col-md-6">
               <div class="form-group">
                   <div>
                        <label class="col-md-2 control-label"><span id="s_ds_market_id">*</span>项目编码</label>
                   </div>
                   <div class="col-md-10">
                        <select class="form-control select" id="market_id" >
                            <option value='' selected = "selected">......</option>
                             {% for var in dm_proj_type %}
                                   {%  if var[0]==market_id %}
                                      <option value={{var[0]}} selected = "selected">{{var[1]}}</option>
                                   {% else %}
                                       <option value={{var[0]}}>{{var[1]}}</option>
                                   {% end %}
                             {% end %}
                        </select>
                   </div>
               </div>
         </div>
       </div>

        <div class="row">
              <div class="col-md-6">
                   <div class="form-group">
                        <div>
                            <label class="col-md-2 control-label"><span id="s_ds_inst_type">*</span>实例类型</label>
                        </div>
                        <div class="col-md-10">
                            <select class="form-control select" id="inst_type" >
                                  <option value='' selected = "selected">......</option>
                                  {% for var in dm_inst_type %}
                                      {%  if var[0]==inst_type %}
                                          <option value={{var[0]}} selected = "selected">{{var[1]}}</option>
                                      {% else %}
                                           <option value={{var[0]}}>{{var[1]}}</option>
                                      {% end %}
                                  {% end %}
                            </select>
                       </div>
                   </div>
              </div>
       </div>
       <div class="row">
           <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <label class="col-md-2 control-label"><span id="s_ds_db_type">*</span>数据库类型</label>
                    </div>
                    <div class="col-md-10">
                        <select class="form-control select" id="db_type" >
                               {% for var in dm_db_type %}
                                   {%  if var[0]==db_type %}
                                      <option value={{var[0]}} selected = "selected">{{var[1]}}</option>
                                   {% else %}
                                       <option value={{var[0]}}>{{var[1]}}</option>
                                   {% end %}
                                {% end %}
                        </select>
                   </div>
               </div>
              </div>
       </div>

       <div class="row">
           <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <label class="col-md-2 control-label"><span id="s_ds_db_env">*</span>数据库环境</label>
                    </div>
                    <div class="col-md-10">
                        <select class="form-control select" id="db_env" >
                           {% for var in dm_db_env %}
                               {%  if var[0]==db_env %}
                                  <option value={{var[0]}} selected = "selected">{{var[1]}}</option>
                               {% else %}
                                   <option value={{var[0]}}>{{var[1]}}</option>
                               {% end %}
                            {% end %}
                        </select>
                   </div>
               </div>
            </div>
       </div>


       <div class="row">
           <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <label class="col-md-2 control-label"><span id="s_ds_db_desc">*</span>数据源描述</label>
                    </div>
                    <div class="col-md-10">
                        <input id="db_desc" type="text" class="form-control" placeholder="请输入数据源描述" value="{{db_desc}}">
                    </div>
               </div>
            </div>
       </div>


       <div class="row">
           <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <label class="col-md-2 control-label"><span id="s_ds_ip">*</span>数据源地址</label>
                    </div>
                    <div class="col-md-10">
                        <input id="ip" type="text" class="form-control" value="{{ip}}">
                    </div>
               </div>
            </div>
       </div>

       <div class="row">
           <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <label class="col-md-2 control-label"><span id="s_ds_port">*</span>数据源端口</label>
                    </div>
                    <div class="col-md-10">
                        <input id="port" type="text" class="form-control" value="{{port}}">
                    </div>
               </div>
            </div>
       </div>


       <div class="row">
           <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <label class="col-md-2 control-label">数据源服务名</label>
                    </div>
                    <div class="col-md-10">
                        <input id="service" type="text" class="form-control" value="{{service}}">
                    </div>
               </div>
            </div>
       </div>

       <div class="row">
           <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <label class="col-md-2 control-label"><span id="s_ds_user">*</span>数据源用户</label>
                    </div>
                    <div class="col-md-10">
                        <input id="user" type="text" class="form-control" value="{{user}}">
                    </div>
               </div>
            </div>
       </div>


       <div class="row">
           <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <label class="col-md-2 control-label"><span id="s_ds_pass">*</span>数据源口令</label>
                    </div>
                    <div class="col-md-10">
                        <input id="pass" name="pass" type="password" class="form-control" value="{{password}}">
                    </div>
               </div>
            </div>
            <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <span class="input-group-btn">
                           <button type="button" id='query_password' class="btn btn-icon waves-effect btn-default m-b-5"><i class="ion-help"></i></button>
                        </span>
                    </div>
               </div>
           </div>
       </div>

       <div class="row">
           <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <label class="col-md-2 control-label"><span id="s_ds_status">*</span>数据源状态</label>
                    </div>
                   <div class="col-md-10">
                        <select class="form-control select" id="status" name="status">
                            {% if status=='1' %}
                               <option value="1" selected = "selected">启用</option>
                               <option value="0">禁用</option>
                            {% end %}

                            {% if status=='0' %}
                                <option value='0' selected = "selected">禁用</option>
                                <option value="1">启用</option>
                            {% end %}
                        </select>
                   </div>
               </div>
            </div>
       </div>

       <div class="row">
           <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <label class="col-md-2 control-label"><span id="s_ds_proxy_status">*</span>是否启用代理</label>
                    </div>
                   <div class="col-md-10">
                        <select class="form-control select" id="proxy_status" name="status">
                            {% if proxy_status=='1' %}
                               <option value="1" selected = "selected">启用</option>
                               <option value="0">禁用</option>
                            {% end %}

                            {% if proxy_status=='0' %}
                                <option value='0' selected = "selected">禁用</option>
                                <option value="1">启用</option>
                            {% end %}
                        </select>
                   </div>
               </div>
            </div>
       </div>

       <div class="row">
           <div class="col-md-6">
               <div class="form-group">
                    <div>
                        <label class="col-md-2 control-label"><span id="s_ds_proxy_server">*</span>代理服务器</label>
                    </div>
                    <div class="col-md-10">
                        <select class="form-control select" id="proxy_server" >
                           {% for var in dm_ds_proxy %}
                               {% if var[0]==proxy_server %}
                                  <option value={{var[0]}} selected = "selected">{{var[1]}}</option>
                               {% else %}
                                   {% if proxy_status=='0' %}
                                      <option value='' selected = "selected">......</option>
                                   {% else %}
                                      <option value={{var[0]}}>{{var[1]}}</option>
                                   {% end %}
                               {% end %}
                           {% end %}
                        </select>
                   </div>
               </div>
            </div>
       </div>
       <br>
       <div class="row">
           <div class="col-md-6">
               <div class="form-group m-b-0">
                    <div class="col-sm-offset-6 col-sm-9">
                      <button id="save" type="button" class="btn btn-custom waves-effect waves-light btn-md">克隆</button>
                      <button id="return" type="button" class="btn btn-custom waves-effect waves-light btn-md">返回</button>
                    </div>
               </div>
           </div>
       </div>
     </form>

     <!-- Sweet-Alert  -->
    <script src="{{static_url('plugins/bootstrap-sweetalert/sweet-alert.min.js')}}"></script>

    <!-- Toastr js -->
    <script src="{{static_url('plugins/toastr/toastr.min.js')}}"></script>

    <script>

        function showtips(flag,title,content){
                toastr.options = {
                      "closeButton": false,
                      "debug": false,
                      "newestOnTop": false,
                      "progressBar": true,
                      "positionClass": "toast-top-right",
                      "preventDuplicates": false,
                      "onclick": null,
                      "showDuration": "3000",
                      "hideDuration": "1000",
                      "timeOut": "5000",
                      "extendedTimeOut": "1000",
                      "showEasing": "swing",
                      "hideEasing": "linear",
                      "showMethod": "fadeIn",
                      "hideMethod": "fadeOut"
                    }
                    toastr[flag](content,title)
        }

        function set_selected(){
            document.all['s_ds_market_id'].style.color="#ff0000";
            document.all['s_ds_inst_type'].style.color="#ff0000";
            document.all['s_ds_db_type'].style.color="#ff0000";
            document.all['s_ds_db_env'].style.color="#ff0000";
            document.all['s_ds_db_desc'].style.color="#ff0000";
            document.all['s_ds_ip'].style.color="#ff0000";
            document.all['s_ds_port'].style.color="#ff0000";
            document.all['s_ds_user'].style.color="#ff0000";
            document.all['s_ds_pass'].style.color="#ff0000";
            document.all['s_ds_status'].style.color="#ff0000";
        }

        set_selected()

        $('#return').on('click', function() {
           $('#main-container-div').load('/ds/change');
        });

        $('#query_password').click(function(){
             showtips('info','','数据源口令：'+$('#pass').val());
        });

        $("#save").click(function () {
          console.log(" status:",$('#status').val())
          $.ajax({
            url: "/ds/clone/save",
            type: "post",
            datatype: "json",
            data: {
                    market_id     :$('#market_id').val(),
                    inst_type     :$('#inst_type').val(),
                    db_type       :$('#db_type').val(),
                    db_env        :$('#db_env').val(),
                    db_desc       :$('#db_desc').val(),
                    ip            :$('#ip').val(),
                    port          :$('#port').val(),
                    service       :$('#service').val(),
                    user          :$('#user').val(),
                    pass          :$('#pass').val(),
                    status        :$('#status').val(),
                    proxy_status  :$('#proxy_status').val(),
                    proxy_server  :$('#proxy_server').val(),
            },
            success: function (dataSet) {
                console.log(dataSet.code, dataSet.message);
                if (dataSet.code==0) {
                   swal("克隆成功", "", "success")
                } else {
                   swal(dataSet.message, "", "error")
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log('jqXHR.responseText=',jqXHR.responseText);
                console.log('jqXHR.status=',jqXHR.status);
                console.log('jqXHR.readyState=',jqXHR.readyState);
                console.log('jqXHR.statusText=',jqXHR.statusText);
                console.log('textStatus=',textStatus);
                console.log('errorThrown=',errorThrown);
                if (jqXHR.status==403){
                    swal("登陆信息已过期，请重新登陆!", "", "error")
                    window.location.href='/login'
                } else if (jqXHR.status==502){
                    swal("用户无权访问权限此功能!", "", "error")
                } else {
                    swal("系统不可用,请稍后重试!", "", "error")
                }
            }
         });
      });

   </script>
</body>

</html>
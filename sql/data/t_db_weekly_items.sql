insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (1,'server','cpu','CPU使用率[%]','SELECT  DATE_FORMAT(create_date,\'%Y-%m-%d %H\') AS rq,\r\n   ROUND(AVG(cpu_total_usage),2) AS val \r\nFROM `t_monitor_task_server_log` \r\nWHERE server_id={}  \r\nAND  create_date between \'{} 0:0:0\' and \'{} 23:59:59\' \r\nGROUP BY DATE_FORMAT(create_date,\'%Y-%m-%d %H\') \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (4,'server','memory','内存使用率[%]','SELECT  DATE_FORMAT(create_date,\'%Y-%m-%d %H:%i\') AS rq,\r\n   ROUND(AVG(mem_usage),2)  AS val \r\nFROM `t_monitor_task_server_log` \r\nWHERE server_id={}  \r\nAND  create_date between \'{} 0:0:0\' and \'{} 23:59:59\' \r\nGROUP BY DATE_FORMAT(create_date,\'%Y-%m-%d %H:%i\') \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (7,'server','disk_usage','磁盘使用率[%]','SELECT  DATE_FORMAT(create_date, \'%Y-%m-%d %H\') AS rq, \r\n        max(disk_usage) AS val \r\nFROM  `t_monitor_task_server_log` \r\nWHERE server_id = {} \r\nAND  create_date between \'{} 0:0:0\' and \'{} 23:59:59\' \r\nGROUP BY DATE_FORMAT(create_date, \'%Y-%m-%d %H\')\r\nORDER BY 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (10,'server','disk_read','磁盘读[KB]','SELECT  DATE_FORMAT(create_date,\'%Y-%m-%d %H:%i\') AS rq,\r\n   ROUND(AVG(disk_read/1024),2)  AS val \r\nFROM `t_monitor_task_server_log` \r\nWHERE server_id={}  \r\nAND  create_date between \'{} 0:0:0\' and \'{} 23:59:59\' \r\nGROUP BY DATE_FORMAT(create_date,\'%Y-%m-%d %H:%i\') \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (13,'server','disk_write','磁盘写[KB]','SELECT  DATE_FORMAT(create_date,\'%Y-%m-%d %H:%i\') AS rq,\r\n   ROUND(AVG(disk_write/1024),2)  AS val \r\nFROM `t_monitor_task_server_log` \r\nWHERE server_id={}  \r\nAND  create_date between \'{} 0:0:0\' and \'{} 23:59:59\' \r\nGROUP BY DATE_FORMAT(create_date,\'%Y-%m-%d %H:%i\') \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (16,'server','net_in','网络流入[KB]','SELECT  DATE_FORMAT(create_date,\'%Y-%m-%d %H:%i\') AS rq,\r\n   ROUND(AVG(net_in/1024),2)  AS val \r\nFROM `t_monitor_task_server_log` \r\nWHERE server_id={}  \r\nAND  create_date between \'{} 0:0:0\' and \'{} 23:59:59\' \r\nGROUP BY DATE_FORMAT(create_date,\'%Y-%m-%d %H:%i\') \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (19,'server','net_out','网络流出[KB]','SELECT  DATE_FORMAT(create_date,\'%Y-%m-%d %H:%i\') AS rq,\r\n ROUND(AVG(net_out/1024),2)  AS val \r\nFROM `t_monitor_task_server_log` \r\nWHERE server_id={}  \r\nAND  create_date between \'{} 0:0:0\' and \'{} 23:59:59\' \r\nGROUP BY DATE_FORMAT(create_date,\'%Y-%m-%d %H:%i\') \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (20,'db','total_conn','总连接数','SELECT \r\n DATE_FORMAT(create_date,\'%Y-%m-%d %h:%i\') AS rq,\r\n  ROUND(AVG(total_connect),2) AS val\r\nFROM `t_monitor_task_db_log`\r\nWHERE db_id={}\r\n AND  create_date BETWEEN \'{} 0:0:0\' AND \'{} 23:59:59\' \r\nGROUP BY DATE_FORMAT(create_date,\'%Y-%m-%d %h:%i\') \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (23,'db','active_conn','活跃连接数','SELECT \r\n DATE_FORMAT(create_date,\'%Y-%m-%d %h:%i\') AS rq,\r\n  ROUND(AVG(active_connect),2) AS val\r\nFROM `t_monitor_task_db_log`\r\nWHERE db_id={}\r\n AND  create_date BETWEEN \'{} 0:0:0\' AND \'{} 23:59:59\' \r\nGROUP BY DATE_FORMAT(create_date,\'%Y-%m-%d %h:%i\') \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (26,'db','qps','每秒查询数[QPS]','SELECT \r\n  DATE_FORMAT(create_date,\'%Y-%m-%d %h:%i\') AS rq,\r\n  ROUND(AVG(db_qps),2) AS val\r\nFROM `t_monitor_task_db_log`\r\nWHERE db_id={}\r\nAND  create_date BETWEEN \'{} 0:0:0\' AND \'{} 23:59:59\' \r\nand  db_qps is not null and db_qps!=\'\' \r\nGROUP BY DATE_FORMAT(create_date,\'%Y-%m-%d %h:%i\') \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (29,'db','tps','每秒事务数[TPS]','SELECT \r\n  DATE_FORMAT(create_date,\'%Y-%m-%d %h:%i\') AS rq,\r\n  ROUND(AVG(db_tps),2) AS val\r\nFROM `t_monitor_task_db_log`\r\nWHERE db_id={}\r\nAND  create_date BETWEEN \'{} 0:0:0\' AND \'{} 23:59:59\' \r\nand  db_tps is not null and db_tps!=\'\' \r\nGROUP BY DATE_FORMAT(create_date,\'%Y-%m-%d %h:%i\') \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (32,'db','backup_size','备份大小[MB]','SELECT \r\nDATE_FORMAT(create_date,\'%Y-%m-%d\') AS rq,\r\nCASE \r\n    WHEN INSTR(total_size,\'G\')>0 THEN REPLACE(total_size,\'G\',\'\')*1024\r\n    WHEN INSTR(total_size,\'M\')>0 THEN REPLACE(total_size,\'M\',\'\')\r\n    ELSE REPLACE(total_size,\'K\',\'\')/1024\r\nEND AS val\r\nFROM `t_db_backup_total`\r\nWHERE db_tag=(SELECT db_tag FROM t_db_config WHERE db_id={}) \r\n AND  create_date BETWEEN \'{} 0:0:0\' AND \'{} 23:59:59\' \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (34,'db','backup_time','备份时长[s]','SELECT \r\nDATE_FORMAT(create_date,\'%Y-%m-%d\') AS rq,\r\nelaspsed_backup AS val\r\nFROM `t_db_backup_total`\r\nWHERE db_tag=(SELECT db_tag FROM t_db_config WHERE db_id={}) \r\n AND  create_date BETWEEN \'{} 0:0:0\' AND \'{} 23:59:59\' \r\norder by 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (37,'db','tbs_usage','表空间使用率[%]','SELECT DATE_FORMAT(create_date, \'%Y-%m-%d\') AS rq, \r\n  MAX(db_tbs_usage) AS val \r\nFROM  `t_monitor_task_db_log` \r\nWHERE db_id = {} \r\nAND  create_date BETWEEN \'{} 0:0:0\' and \'{} 23:59:59\' \r\nAND  db_tbs_usage IS NOT NULL AND db_tbs_usage!=\'\' AND db_tbs_usage!=\'None\'\r\nGROUP BY DATE_FORMAT(create_date, \'%Y-%m-%d\')\r\nORDER BY 1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (38,'db_detail','server_info','服务器地址:{}','SELECT  \r\n  \'指标\'      AS flag, \r\n \'最小值\'    AS val_min,\r\n  \'最大值\'    AS val_max,\r\n  \'平均值\'    AS val_avg,\r\n  \'当前值\'    AS val_cur,\r\n  \'告警阀值\'  AS threshold,\r\n \'备注  \'    AS message\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n           \'cpu使用率\'                      AS flag, \r\n           ROUND(MIN(cpu_total_usage),2)   AS val_min,\r\n         ROUND(MAX(cpu_total_usage),2)   AS val_max,\r\n         ROUND(AVG(cpu_total_usage),2)   AS val_avg,\r\n        \'阀值:连续3次>85%\'                AS threshold,\r\n        \'未触发告警\'                      AS message\r\n      FROM `t_monitor_task_server_log`\r\n      WHERE server_id=$$SERVER_ID$$\r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\') a,\r\n     (SELECT \r\n          cpu_total_usage   AS val_cur\r\n      FROM `t_monitor_task_server_log` \r\n      WHERE server_id=$$SERVER_ID$$ \r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n  ORDER BY create_date DESC LIMIT 1) b\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n           \'内存使用率\'                   AS flag, \r\n           ROUND(MIN(mem_usage),2)       AS val_min,\r\n         ROUND(MAX(mem_usage),2)       AS val_max,\r\n         ROUND(AVG(mem_usage),2)       AS val_avg,\r\n        \'阀值:连续3次>85%\'              AS threshold,\r\n        \'未触发告警\'                    AS message\r\n      FROM `t_monitor_task_server_log`\r\n      WHERE server_id=$$SERVER_ID$$\r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\') a,\r\n     (SELECT \r\n          mem_usage   AS val_cur\r\n      FROM `t_monitor_task_server_log` \r\n      WHERE server_id=$$SERVER_ID$$ \r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n  ORDER BY create_date DESC LIMIT 1) b\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n           \'磁盘使用率\'                     AS flag, \r\n            MIN(disk_usage)               AS val_min,\r\n            MAX(disk_usage)               AS val_max,\r\n          \'\'                            AS val_avg,\r\n        \'阀值:连续3次>80%\'              AS threshold,\r\n        \'未触发告警\'                    AS message\r\n      FROM `t_monitor_task_server_log`\r\n      WHERE server_id=$$SERVER_ID$$\r\n       and  disk_usage is not null and disk_usage!=\'\' and disk_usage!=\'None\'\r\n       and  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\' ) a,\r\n     (SELECT \r\n          disk_usage   AS val_cur\r\n      FROM `t_monitor_task_server_log` \r\n      WHERE server_id=$$SERVER_ID$$ \r\n       and  disk_usage is not null and disk_usage!=\'\' and disk_usage!=\'None\'\r\n       and  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n ORDER BY create_date DESC LIMIT 1) b','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (41,'db_detail','db_info','数据库地址:{}:{}/{}','SELECT  \r\n  \'指标\'      AS flag, \r\n \'最小值\'    AS val_min,\r\n  \'最大值\'    AS val_max,\r\n  \'平均值\'    AS val_avg,\r\n  \'当前值\'    AS val_cur,\r\n  \'告警阀值\'  AS threshold,\r\n \'备注  \'    AS message\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n           \'总连接数\' AS flag,  \r\n         MIN(total_connect+0) AS val_min,\r\n        MAX(total_connect+0) AS val_max,\r\n        ROUND(AVG(total_connect+0),2) AS val_avg,\r\n        \'阀值 >300\'                   AS threshold,\r\n       \'未触发告警\'                   AS message\r\n      FROM `t_monitor_task_db_log`\r\n      WHERE db_id=$$DB_ID$$\r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\') a,\r\n     (SELECT \r\n          total_connect+0  AS val_cur\r\n      FROM `t_monitor_task_db_log` \r\n      WHERE db_id=$$DB_ID$$ AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n ORDER BY create_date DESC LIMIT 1) b\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n       \'活跃连接数\' AS flag,  \r\n    MIN(active_connect+0) AS val_min,\r\n     MAX(active_connect+0) AS val_max,\r\n     ROUND(AVG(total_connect+0),2) AS val_avg,\r\n     \'阀值 >100\'                   AS threshold,\r\n     \'未触发告警\'                   AS message\r\n      FROM `t_monitor_task_db_log`\r\n      WHERE db_id=$$DB_ID$$\r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\') a,\r\n     (SELECT \r\n          active_connect+0  AS val_cur\r\n      FROM `t_monitor_task_db_log` \r\n      WHERE db_id=$$DB_ID$$ \r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n  ORDER BY create_date DESC LIMIT 1) b\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n       \'每秒查询率[QPS]\'       AS flag,  \r\n     MIN(db_qps+0)          AS val_min,\r\n    MAX(db_qps+0)          AS val_max,\r\n    ROUND(AVG(db_qps+0),2) AS val_avg,\r\n    \'阀值 >600\'             AS threshold,\r\n     \'未触发告警\'             AS message\r\n      FROM `t_monitor_task_db_log`\r\n      WHERE db_id=$$DB_ID$$\r\n       and  db_qps is not null and db_qps!=\'\' \r\n       and  create_date BETWEEN \'$$TJRQQ$$\' AND \'$$TJRQZ$$\') a,\r\n     (SELECT \r\n          db_qps+0  AS val_cur\r\n      FROM `t_monitor_task_db_log` \r\n      WHERE db_id=$$DB_ID$$ \r\n       and  db_qps is not null and db_qps!=\'\' \r\n       and  create_date BETWEEN \'$$TJRQQ$$\' AND \'$$TJRQZ$$\' \r\n ORDER BY create_date DESC LIMIT 1) b\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n       \'每秒事务数[TPS]\'        AS flag,  \r\n     MIN(db_tps+0)          AS val_min,\r\n      MAX(db_tps+0)          AS val_max,\r\n      ROUND(AVG(db_tps+0),2) AS val_avg,\r\n     \'阀值 >100\'             AS threshold,\r\n     \'未触发告警\'             AS message\r\n      FROM `t_monitor_task_db_log`\r\n      WHERE db_id=$$DB_ID$$\r\n       and  db_tps is not null and db_tps!=\'\' \r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\') a,\r\n     (SELECT \r\n          db_tps+0  AS val_cur\r\n      FROM `t_monitor_task_db_log` \r\n      WHERE db_id=$$DB_ID$$ \r\n      and  db_tps is not null and db_tps!=\'\' \r\n      and  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n  ORDER BY create_date DESC LIMIT 1) b\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n       \'表空间使用率\'            AS flag,  \r\n     IFNULL(MIN(db_tbs_usage),\'-\') AS val_min,\r\n        IFNULL(MAX(db_tbs_usage),\'-\') AS val_max,\r\n        \'\' AS val_avg,\r\n        CASE WHEN MIN(db_tbs_usage) IS NULL THEN \'-\' ELSE \'阀值 >85%\'  END   AS threshold,\r\n        CASE WHEN MIN(db_tbs_usage) IS NULL THEN \'-\' ELSE \'未触发告警\' END   AS message\r\n      FROM `t_monitor_task_db_log`\r\n      WHERE db_id=$$DB_ID$$\r\n       and  db_tbs_usage is not null and db_tbs_usage!=\'\' and db_tbs_usage!=\'None\'\r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\') a,\r\n     (SELECT \r\n          db_tbs_usage  AS val_cur\r\n      FROM `t_monitor_task_db_log` \r\n      WHERE db_id=$$DB_ID$$ \r\n      and  db_tbs_usage is not null and db_tbs_usage!=\'\' and db_tbs_usage!=\'None\'\r\n      and  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n ORDER BY create_date DESC LIMIT 1) b\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n            \'备份大小[MB]\' AS flag,\r\n            MIN(CASE \r\n                WHEN INSTR(total_size,\'G\')>0 THEN REPLACE(total_size,\'G\',\'\')*1024\r\n                WHEN INSTR(total_size,\'M\')>0 THEN REPLACE(total_size,\'M\',\'\')\r\n                ELSE REPLACE(total_size,\'K\',\'\')/1024\r\n            END) AS val_min,\r\n            MAX(CASE \r\n                WHEN INSTR(total_size,\'G\')>0 THEN REPLACE(total_size,\'G\',\'\')*1024\r\n                WHEN INSTR(total_size,\'M\')>0 THEN REPLACE(total_size,\'M\',\'\')\r\n                ELSE REPLACE(total_size,\'K\',\'\')/1024\r\n            END) AS val_max,\r\n            ROUND(AVG(\r\n            CASE \r\n                WHEN INSTR(total_size,\'G\')>0 THEN REPLACE(total_size,\'G\',\'\')*1024\r\n                WHEN INSTR(total_size,\'M\')>0 THEN REPLACE(total_size,\'M\',\'\')\r\n                ELSE REPLACE(total_size,\'K\',\'\')/1024\r\n            END),2) AS val_avg,\r\n            \'\'    AS threshold,\r\n            \'\'    AS message\r\n        FROM `t_db_backup_total`\r\n        WHERE db_tag=(SELECT db_tag FROM t_db_config WHERE db_id=$$DB_ID$$) \r\n         AND  create_date between \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\' ) a,\r\n     (SELECT \r\n          CASE \r\n                WHEN INSTR(total_size,\'G\')>0 THEN REPLACE(total_size,\'G\',\'\')*1024\r\n                WHEN INSTR(total_size,\'M\')>0 THEN REPLACE(total_size,\'M\',\'\')\r\n                ELSE REPLACE(total_size,\'K\',\'\')/1024\r\n          END  AS val_cur\r\n      FROM `t_db_backup_total` \r\n      WHERE db_tag=(SELECT db_tag FROM t_db_config WHERE db_id=$$DB_ID$$) \r\n       and  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n     ORDER BY create_date DESC LIMIT 1) b\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n            \'备份时长[S]\' AS flag,\r\n            MIN(elaspsed_backup) AS val_min,\r\n            MAX(elaspsed_backup) AS val_max,\r\n            ROUND(AVG(elaspsed_backup),2) AS val_avg,\r\n            \'\'    AS threshold,\r\n            \'\'    AS message\r\n        FROM `t_db_backup_total`\r\n        WHERE db_tag=(SELECT db_tag FROM t_db_config WHERE db_id=$$DB_ID$$) \r\n         AND  create_date between \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\' ) a,\r\n     (SELECT \r\n         elaspsed_backup AS val_cur\r\n      FROM `t_db_backup_total` \r\n      WHERE db_tag=(SELECT db_tag FROM t_db_config WHERE db_id=$$DB_ID$$) \r\n       and  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n      ORDER BY create_date DESC LIMIT 1) b','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (44,'app_detail','server_info','服务器地址:{}','SELECT  \r\n \'指标\'      AS flag, \r\n \'最小值\'    AS val_min,\r\n  \'最大值\'    AS val_max,\r\n  \'平均值\'    AS val_avg,\r\n  \'当前值\'    AS val_cur,\r\n  \'告警阀值\'  AS threshold,\r\n \'备注  \'    AS message\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n           \'cpu使用率\'                      AS flag, \r\n           ROUND(MIN(cpu_total_usage),2)   AS val_min,\r\n         ROUND(MAX(cpu_total_usage),2)   AS val_max,\r\n         ROUND(AVG(cpu_total_usage),2)   AS val_avg,\r\n        \'阀值:连续3次>85%\'                AS threshold,\r\n        \'未触发告警\'                      AS message\r\n      FROM `t_monitor_task_server_log`\r\n      WHERE server_id=$$SERVER_ID$$\r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\') a,\r\n     (SELECT \r\n          cpu_total_usage   AS val_cur\r\n      FROM `t_monitor_task_server_log` \r\n      WHERE server_id=$$SERVER_ID$$ \r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n  ORDER BY create_date DESC LIMIT 1) b\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n           \'内存使用率\'                   AS flag, \r\n           ROUND(MIN(mem_usage),2)       AS val_min,\r\n         ROUND(MAX(mem_usage),2)       AS val_max,\r\n         ROUND(AVG(mem_usage),2)       AS val_avg,\r\n        \'阀值:连续3次>85%\'              AS threshold,\r\n        \'未触发告警\'                    AS message\r\n      FROM `t_monitor_task_server_log`\r\n      WHERE server_id=$$SERVER_ID$$\r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\') a,\r\n     (SELECT \r\n          mem_usage   AS val_cur\r\n      FROM `t_monitor_task_server_log` \r\n      WHERE server_id=$$SERVER_ID$$ \r\n       AND  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n  ORDER BY create_date DESC LIMIT 1) b\r\nUNION ALL\r\nSELECT     \r\n   a.flag,  \r\n   a.val_min,\r\n   a.val_max,\r\n   a.val_avg,\r\n   b.val_cur,\r\n   a.threshold,\r\n   a.message\r\nFROM (SELECT \r\n           \'磁盘使用率\'                     AS flag, \r\n            MIN(disk_usage)               AS val_min,\r\n            MAX(disk_usage)               AS val_max,\r\n          \'\'                            AS val_avg,\r\n        \'阀值:连续3次>80%\'              AS threshold,\r\n        \'未触发告警\'                    AS message\r\n      FROM `t_monitor_task_server_log`\r\n      WHERE server_id=$$SERVER_ID$$\r\n       and  disk_usage is not null and disk_usage!=\'\' and disk_usage!=\'None\'\r\n       and  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\' ) a,\r\n     (SELECT \r\n          disk_usage   AS val_cur\r\n      FROM `t_monitor_task_server_log` \r\n      WHERE server_id=$$SERVER_ID$$ \r\n       and  disk_usage is not null and disk_usage!=\'\' and disk_usage!=\'None\'\r\n       and  create_date BETWEEN \'$$TJRQQ$$ 0:0:0\' and \'$$TJRQZ$$ 23:59:59\'\r\n ORDER BY create_date DESC LIMIT 1) b','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (45,'week_detail','header','周报详情-标题','SELECT \'    本周投资系统、OA系统、BI系统、乐软系统、结算系统、资产租赁系统、招采系统运行良好，服务均正常，本地及异机备份均正常。\' AS v1','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (46,'week_detail','body','周报详情-表格','SELECT \'系统名称\'   AS v1,\r\n  \'DB服务\'    AS v2,  \r\n  \'GIT服务\'   AS v3,\r\n  \'NGINX服务\' AS v4,\r\n  \'WEB服务\'   AS v5,\r\n  \'SSO服务\'   AS v6,\r\n  \'备份脚本\'  AS v7,\r\n  \'清理脚本\'  AS v8\r\nUNION ALL\r\nSELECT  \'投资系统\'  AS v1,\r\n  \'g\'         AS v2,  \r\n  \'g\'         AS v3,\r\n  \'\'          AS v4,\r\n  \'\'          AS v5,\r\n  \'\'          AS v6,\r\n  \'\'          AS v7,\r\n  \'\'          AS v8\r\nUNION ALL\r\nSELECT  \'OA系统\'    AS v1,\r\n  \'g\'         AS v2,  \r\n  \'\'          AS v3,\r\n  \'g\'         AS v4,\r\n  \'g,g\'       AS v5,\r\n  \'g,g\'       AS v6,\r\n  \'g\'         AS v7,\r\n  \'\'          AS v8\r\nUNION ALL\r\nSELECT  \'BI系统\'    AS v1,\r\n  \'g\'         AS v2,  \r\n  \'\'          AS v3,\r\n  \'\'          AS v4,\r\n  \'g,g\'       AS v5,\r\n  \'\'          AS v6,\r\n  \'g\'         AS v7,\r\n  \'\'          AS v8\r\nUNION ALL\r\nSELECT  \'乐软系统\'  AS v1,\r\n  \'g\'         AS v2,  \r\n  \'\'          AS v3,\r\n  \'\'          AS v4,\r\n  \'g\'         AS v5,\r\n  \'\'          AS v6,\r\n  \'g\'         AS v7,\r\n  \'\'          AS v8\r\nUNION ALL\r\nSELECT  \'结算系统\'  AS v1,\r\n  \'g,g,g\'     AS v2,  \r\n  \'\'          AS v3,\r\n  \'\'          AS v4,\r\n  \'g,g\'       AS v5,\r\n  \'\'          AS v6,\r\n  \'\'          AS v7,\r\n  \'\'          AS v8\r\nUNION ALL\r\nSELECT  \'资产租赁系统\' AS v1,\r\n   \'g,g\'       AS v2,  \r\n  \'\'          AS v3,\r\n  \'\'          AS v4,\r\n  \'g\'         AS v5,\r\n  \'\'          AS v6,\r\n  \'\'          AS v7,\r\n  \'\'          AS v8 \r\nUNION ALL\r\nSELECT  \'招采系统\'  AS v1,\r\n   \'g\'         AS v2,  \r\n  \'\'          AS v3,\r\n  \'g,g\'       AS v4,\r\n  \'g,g\'       AS v5,\r\n  \'\'          AS v6,\r\n  \'\'          AS v7,\r\n  \'\'          AS v8 \r\nUNION ALL\r\nSELECT  \'备份服务器\' AS v1,\r\n   \'\'           AS v2, \r\n  \'\'           AS v3,\r\n   \'\'           AS v4,\r\n   \'\'           AS v5,\r\n   \'\'           AS v6,\r\n   \'\'           AS v7,\r\n   \'g\'          AS v8 ','1');
insert  into `t_db_weekly_items`(`id`,`item_type`,`item_code`,`item_desc`,`item_tjsql`,`status`) values (47,'week_detail','footer','周报详情-说明','SELECT \'表格说明:;  1、表格内容为空表示没有相应服务;  2、绿灯表示服务正常、红灯表示服务严重故障，黄灯表示一般故障;  3、一个单元格内多个灯表示相同的服务有多个。\' AS v1','1');
